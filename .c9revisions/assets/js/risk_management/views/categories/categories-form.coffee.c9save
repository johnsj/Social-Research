{"ts":1345451905449,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"window.Risk = window.Risk || {}\nwindow.Risk.views = window.Risk.views || {}\n\n\nclass CategoryFormView extends Backbone.View\n  \n  tagName: \"div\"\n\n  initialize:->\n    _.bindAll @\n    @collection = window.Risk.collections.Categories\n    @template = _.template $('#risk-form-template').html()\n    @metaCollection = window.Risk.collections.MetaCategories\n    @metaCollection.bind 'reset', @addOptions\n\n  render:->\n    $(@el).html @template\n    @renderMetaOptions()\n\n\n  renderMetaOptions:->\n    @metaCollection.fetch()\n\n  addOptions:->\n    _.each @metaCollection.models, (model)=>\n      @addOption model\n\n  addOption:(model)->\n    $(@el).find('select#category_parent').append $('<option>').prop('value', model.get('_id')).text(model.get('title'))\n\n  events:\n    \"click button#add_category\": \"save\"\n    \"click a#error-item-close\": \"hideError\"\n\n  save:(event)->\n    title = $('input#category_name').val() unless $('input#category_name').val() is \"\"\n    description = $('textarea#category_description').val()\n    parent = $('select#category_parent option:selected').val()\n    saveData =\n      title: title\n      description: description\n      parent: parent\n    #@collection.create saveData\n    newModel = new @collection.model\n\n    newModel.collection = @collection\n\n    newModel.on \"error\", (model, response)=>\n      if response.status isnt 200\n        @showErrorBox response\n      if response.status is 200\n        console.log \"got 200\"\n\n    saveOptions =\n      wait: true\n      error:(model, response)->\n        if response.status is 200\n          window.location.hash = \"/categories\"\n      success:(model, response)->\n        window.location.hash = \"/categories\"\n\n    newModel.save saveData, saveOptions\n\n  showErrorBox:(msg)->\n    errorTemplate = _.template $('#error-item-template').html()\n    $('#errorlist').append errorTemplate {msg: msg}\n\n  hideError:(event)->\n    $(event.target.parentElement).remove()\n    \n\nwindow.Risk.views.CategoryFormView = CategoryFormView"]],"start1":0,"start2":0,"length1":0,"length2":1964}]],"length":1964}
